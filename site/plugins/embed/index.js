(function(){"use strict";function o(e){const i=/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\.-]+)+[\w\-\._~:/?#[\]@!\$&'\(\)\*\+,;=.]+$/g,t=new RegExp(i);return!e||e.match(t)}function l(e,i){const t={youtube:/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,vimeo:/vimeo\.com\/([0-9]+)/,flickr:/^.*(flickr\.com)\/(.*)/,soundcloud:/^.*(soundcloud\.com|snd\.sc)\/(.*)/,twitter:/^.*(twitter\.com)\/(.*)/,instagram:/^.*(instagram\.com)\/(.*)/};return Object.keys(t).indexOf(i)==-1?!1:e.match(t[i])}var b=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("k-field",e._b({staticClass:"k-embed-field k-url-field k-field",attrs:{input:e._uid}},"k-field",e.$props,!1),[e.hasMedia?t("div",{staticClass:"preview",attrs:{"data-provider":e.providerName}},[t("div",{staticClass:"preview-content",domProps:{innerHTML:e._s(e.media.code)}}),t("div",{staticClass:"preview-background"})]):e._e(),t("k-input",e._g(e._b({ref:"input",attrs:{id:e._uid,value:e.inputValue,media:e.media,theme:"field"},on:{setMedia:e.setMedia,startLoading:e.startLoading}},"k-input",e.$props,!1),e.$listeners),[t("div",{staticClass:"k-embed-infos",attrs:{slot:"icon"},slot:"icon"},[t("div",{staticClass:"k-embed-status"},[e.loading?t("span",{staticClass:"k-embed-status-loading"},[t("span",{staticClass:"loader"})]):e.hasMedia?t("span",{staticClass:"k-embed-status-synced"},[e._v(e._s(e.$t("embed.synced"))+" "),t("span",{staticClass:"checkmark"})]):e.syncFailed?t("span",{staticClass:"k-embed-status-failed"},[e._v(e._s(e.$t("embed.failed"))+" "),t("span",{staticClass:"cross"})]):e._e()]),e.link?t("k-button",{staticClass:"k-input-icon-button",attrs:{icon:e.icon,link:e.inputValue,tooltip:e.$t("open"),tabindex:"-1",target:"_blank",rel:"noopener"}}):e._e()],1)])],1)},g=[],H="";function d(e,i,t,h,r,p,_,I){var s=typeof e=="function"?e.options:e;i&&(s.render=i,s.staticRenderFns=t,s._compiled=!0),h&&(s.functional=!0),p&&(s._scopeId="data-v-"+p);var n;if(_?(n=function(a){a=a||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!a&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(a=__VUE_SSR_CONTEXT__),r&&r.call(this,a),a&&a._registeredComponents&&a._registeredComponents.add(_)},s._ssrRegister=n):r&&(n=I?function(){r.call(this,(s.functional?this.parent:this).$root.$options.shadowRoot)}:r),n)if(s.functional){s._injectStyles=n;var U=s.render;s.render=function(x,v){return n.call(v),U(x,v)}}else{var f=s.beforeCreate;s.beforeCreate=f?[].concat(f,n):[n]}return{exports:e,options:s}}const w={extends:"k-url-field",data(){return{media:Object,loading:!1}},props:{provider:String},created(){this.value&&this.value.media&&this.hasLength(this.value.media)&&(this.media=this.value.media)},watch:{inputValue(){this.value&&this.value.media&&this.hasLength(this.value.media)?this.media=this.value.media:this.media={}}},computed:{hasMedia(){return this.hasLength(this.media)&&this.media.code},providerName(){return this.hasMedia&&this.media.providerName?this.media.providerName.toLowerCase():null},syncFailed(){return this.inputValue!=""&&this.isValidUrl(this.inputValue)&&!this.hasMedia},inputValue(){return this.value&&this.value.input?this.value.input:""}},methods:{setMedia(e){this.media=e,this.stopLoading()},hasLength(e){return Object.keys(e).length},startLoading(){this.loading=!0},stopLoading(){this.loading=!1},isValidUrl(e){return!(!o(e)||this.provider&&!l(e,this.provider))}}},u={};var k=d(w,b,g,!1,C,null,null,null);function C(e){for(let i in u)this[i]=u[i]}var $=function(){return k.exports}();const y={extends:"k-url-input",props:{provider:String,media:Object},mounted(){this.loadEmbedScripts()},methods:{onInput(e){if(e==""||!this.isValidUrl(e))return this.media={},this.emitInput(e),!1;this.$emit("startLoading"),this.$api.get("kirby-embed/get-data",{url:e}).then(i=>{if(i.status=="success"&&i.data){if(i.data.providerName=="Vimeo"){let t=i.data.code;t=this.htmlToElement(t),t.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),i.data.code=t.outerHTML}if(i.data.providerName=="Instagram"){let t=`<iframe src="${e}/embed" width="100%"></iframe>`;t=this.htmlToElement(t),t.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),i.data.code=t.outerHTML}this.media=i.data}else this.media={};this.emitInput(e)}).catch(i=>{this.media={},this.emitInput(e)})},emitInput(e){this.$emit("input",{input:e,media:this.media}),this.$emit("setMedia",this.media),this.loadEmbedScripts()},loadEmbedScripts(){if(window.twttr)window.twttr.widgets.load();else if(this.media&&Object.keys(this.media).length&&this.media.providerName.toLowerCase()=="twitter"){const e=document.createElement("script");e.src="https://platform.twitter.com/widgets.js",document.body.appendChild(e)}if(window.instgrm)window.instgrm.Embeds.process();else if(this.media&&Object.keys(this.media).length&&this.media.providerName.toLowerCase()=="instagram"){const e=document.createElement("script");e.src="https://www.instagram.com/embed.js",document.body.appendChild(e)}},isValidUrl(e){return!(!o(e)||this.provider&&!l(e,this.provider))},htmlToElement(e){let i=document.createElement("template");return e=e.trim(),i.innerHTML=e,i.content.firstChild}}};let L,M;const c={};var E=d(y,L,M,!1,V,null,null,null);function V(e){for(let i in c)this[i]=c[i]}var j=function(){return E.exports}(),S=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"k-embed-field-preview"},[t("div",{staticClass:"k-structure-table-text"},[e._v(e._s(e.url)+" "),e.synced?t("span",{staticClass:"k-embed-field-preview-icon"},[e._v("\u2713")]):e._e()])])},T=[];const N={props:{value:String},computed:{url(){return this.value.input.replace(/^\/\/|^.*?:\/\//,"")},synced(){return Object.keys(this.value.media).length}}},m={};var O=d(N,S,T,!1,R,null,null,null);function R(e){for(let i in m)this[i]=m[i]}var F=function(){return O.exports}();panel.plugin("sylvainjule/embed",{fields:{embed:$},components:{"k-embed-input":j,"k-embed-field-preview":F}})})();
